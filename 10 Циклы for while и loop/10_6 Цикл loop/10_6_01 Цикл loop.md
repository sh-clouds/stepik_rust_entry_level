Цикл loop

loop - простейший цикл в Rust, реализующий возможность бесконечного выполнения, пока не будет достигнуто выражение прерывания break.

Запуск следующей программы, приведёт к бесконечному выводу строки Rust. Если всё таки решитесь запустить, используйте комбинацию клавиш ctrl-c для остановки выполнения программы.

fn main() {
    loop {
        println!("Rust");
    }
}

loop - это нечто большее, чем бесконечный цикл while true. Существуют дополнительные функции, которые в некоторых обстоятельствах делают этот цикл уникальным и предпочтительным по сравнению с циклом while true. Одной из таких возможностей является использование break внутри loop для возвращения значения из цикла.


Возврат значения

Наиболее часто loop применяют в возврате значения из цикла. Помимо завершения, break также может возвращать результат цикла, которое доступно только для loop:

Для этого необходимо добавить возвращаемое значение после выражения break:

fn main() {
    let arr = [1, 2, 4, 7, 9, 10, 11];
    let mut i = 0;

    let odd_num = loop {
        if arr[i] % 3 == 0 {
            break arr[i];
        }
        i += 1;
    };
    println!("Число {odd_num} нечетное");
}

Найденный элемент arr[i] будет возвращён из цикла и присвоен odd_num с возможностью дальнейшего использования в программе.

Можем ли мы в этом случае опустить точку с запятой в конце break ? Да можем:

fn main() {
    let arr = [1, 2, 4, 7, 9, 10, 11];
    let mut i = 0;

    let odd_num = loop {
        if arr[i] % 3 == 0 {
            break arr[i]
        }
        i += 1;
    };
    println!("Число {odd_num} нечетное");
}

Игровая площадка ⛱️

Концептуально это ничего не изменит. В контексте потока управления не важно, будет ли break инструкцией break arr[i]; или выражением break arr[i], потому что весь смысл break <value>; или break <value> состоит в том, чтобы прервать цикл loop с указанным значением в качестве результата.

Другими словами, используйте ; после break и continue, и пусть вас не смущает ; после break arr[i]; внутри loop  "возвращающий" значение.