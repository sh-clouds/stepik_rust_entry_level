Побитовые операторы

Битовые, побитовые (bitwise) операции используются для манипулирования индивидуальными битами целых чисел.

Именно битовые операции в сочетании с запоминающими элементами (например, триггерами) реализуют всё богатство возможностей современной цифровой техники.

Побитовые операторы:

Название	           Оператор	      Пример           Результат
                                              a = -6, b = 2	

Побитовый И	           &	              a & b	       2
Побитовый ИЛИ	           |	              a | b	       -6
Побитовое
исключающее ИЛИ	           ^	              a ^ b	       -8
Побитовое отрицание	   !	              !a, !b	       5, -3
Побитовый сдвиг влево	   <<	              a << b	       -24
Побитовый сдвиг вправо	   >>	              a >> b	       -2


Форматная строка для двоичной системы

При работе с числами в двоичном представлении, когда дело доходит до вывода, особенно полезными оказываются незначащие нули. На этот случай мы можем воспользоваться форматной строкой:

Для вывода числа в двоичной системе используется соответствующий спецификатор типа: {:b};

Далее необходимо установить параметр ширины поля, который может быть задан либо литерально {:8b}, либо в качестве аргумента:{:width$b};

Затем поместить флаг заполнения 0, который указывает, что если значение имеет меньшую ширину, чем задано, оно будет заполнено нулями слева:{:0width$b}.

В качестве примера выведем целое число 1u8 вместе с незначащими нулями:

fn main() {
    println!("{:08b}", 1u8);
}

Игровая площадка ⛱️

Побитовый И
Битовая операция И (AND) комбинирует два целочисленных значения одинаковой длины и выполняет логическую операцию И над каждой парой соответствующих битов. Каждый бит в новом значении меняется на 1 , только если оба соответствующих бита в исходных значениях равны 1. Если хотя бы один из соответствующих битов равен 0, то результирующий бит будет установлен в 0. Рассмотрим примеры:

Для беззнаковых типа:

          a = 7u8, b = 20u8

Разряды	  7	6	5	4	3	2	1	0
a2        0	0	0	0	0	1	1	1
b2        0	0	0	1	0	1	0	0
a2&b2     0	0	0	0	0	1	0	0

При работе со знаковыми типами помните, что они хранятся с использованием представления дополнения до двух, а значит, у нас появляется дополнительный бит для знака числа:

c = 11i8, d = -20i8
Разряды	  Знаковый    6 5 4 3 2 1 0
          разряд	

c2        0	          0	0	0	1	0	1	1
d2        1	          1	1	0	1	1	0	0
c2 & d2   0	          0	0	0	1	0	0	0

Игровая площадка ⛱️


Побитовый ИЛИ

Битовая операция ИЛИ (OR) комбинирует два целочисленных значения одинаковой длины и выполняет логическую операцию ИЛИ над каждой парой соответствующих битов. Каждый бит в новом значении меняется на 1 , если один или оба бита в одной и той же позиции равны 1, в противном случае результирующий бит устанавливается в 0. Рассмотрим примеры:

Для беззнаковых типа:
        a = 7u8, b = 20u8

Разряды	  7	6	5	4	3	2	1	0

a2        0	0	0	0	0	1	1	1
b2        0	0	0	1	0	1	0	0
a2∣b2     0	0	0	1	0	1	1	1


Для знакового типа:

          c = 11i8, d = -20i8
Разряды	Знаковый        6       5       4       3       2       1       0
        разряд	

c2      0	        0	0	0	1	0	1	1
d2      1	        1	1	0	1	1	0	0
c2∣d2    1	         1	1	0	1	1	1	1

Игровая площадка ⛱️



Побитовое исключающее ИЛИ

Битовое исключающее ИЛИ (XOR) комбинирует два целочисленных значения одинаковой длины и выполняет логическую операцию ИЛИ над каждой парой соответствующих битов. Каждый бит в новом значении меняется на 1, если один из соответствующих бит в исходных значениях равен 1. Если оба соответствующих бита равны 0 или 1, то результирующий бит устанавливается в 0. Рассмотрим примеры:

Для беззнаковых типа:

        a = 7u8, b = 20u8
Разряды	      7	6	5	4	3	2	1	0
a2∣b2         0	0	0	0	0	1	1	1
a2∣b2         0	0	0	1	0	1	0	0
a2^a2∣b2      0	0	0	1	0	0	1	1


Для знакового типа:

            c = 11i8, d = -20i8
Разряды	Знаковый
        разряд	            6	5	4	3	2	1	0
c2      0	            0	0	0	1	0	1	1
d2      1	            1	1	0	1	1	0	0
c2^d2   1	            1	1	0	0	1	1	1



Побитовое отрицание

Битовое отрицание (NOT) для логических типов преобразует значение true в false и, наоборот, false в true. При применении же к числам меняет каждый индивидуальный бит на противоположный 1 на 0 и 0 на 1. 

Рассмотрим примеры:

Для беззнаковых типа:

        a = 7u8, b = 248u8
Разряды	7	6	5	4	3	2	1	0
a2      0	0	0	0	0	1	1	1
!a2∣b2  1	1	1	1	1	0	0	0
a2∣b2   1	1	1	1	1	0	0	0
!b2     0	0	0	0	0	1	1	1

Для знакового типа:

c = 11i8, d = -12i8
Разряды	Знаковый        6       5       4       3       2       1       0
        разряд
        	
c2∣d2   0	        0	0	0	1	0	1	1
!c2∣d2  1	        1	1	1	0	1	0	0
c2∣d2   1	        1	1	1	0	1	0	0
!c2∣d2  0	        0	0	0	1	0	1	1


Игровая площадка ⛱️


Побитовые операторы сдвига

Побитовые операторы сдвига перемещают все биты только значений целого типа влево или вправо на указанное число позиций. 

Сдвиг влево

Операция сдвига влево (left shift) представлена оператором <<:

значение << сдвиг

Где значение сдвигаемое целое число, а сдвиг - количество битов смещения.



Сдвиг должен быть положительным и меньше количества бит значения, т.е. для u/i 8 сдвиг не больше 7, для u/i 16 не больше 15 и т.д.

Рассмотрим примеры:


Для беззнаковых типов используется логический сдвиг влево:

                        a = 71u8, l = 1
Разряды	        7	6	5	4	3	2	1	0
a2∣b2           0	1	0	0	0	1	1	1
a << l          1	0	0	0	1	1	1	0

Для знаковых типов используется арифметический сдвиг влево и теперь необходимо быть внимательным при работе со знаковыми типами, поскольку знаковый разряд (бит) также сдвигается:

                        b = 71i8, l = 1
Разряды	Знаковый        6       5       4       3       2       1       0
        разряд	

a2∣b2   0	        1	0	0	0	1	1	1
b << l  1	        0	0	0	1	1	1	0
 

                        c = -114i8, l = 1
Разряды	Знаковый        6       5       4       3       2       1       0
        разряд	

c2∣d2   1	        0	0	0	1	1	1	0
c <<   0	        0	0	1	1	1	0	0

Сдвиг на одну позицию влево эквивалентен умножению на 2. В об­щем случае сдвиг на n позиций влево эквивалентен умножению на 2**n


Игровая площадка ⛱️

Сдвиг вправо

Операция сдвига вправо (right shift) представлена оператором >>:

значение >> сдвиг

Где значение сдвигаемое целое число, а сдвиг - количество битов смещения. Рассмотрим примеры:

Для беззнаковых типов используется логический сдвиг вправо:

                a = 71u8, l = 1
Разряды	        7	6	5	4	3	2	1	0
a2              0	1	0	0	0	1	1	1
a >> l          0	0	1	0	0	0	1	1

Для знаковых типов используется арифметический сдвиг вправо и теперь знаковый разряд остаётся без изменений:

                        b = -100i8, l = 1
Разряды	Знаковый        6       5       4       3       2       1       0
        разряд	
b2      1	        0	0	1	1	1	0	0
b >> l	1	        1       0	0	1	1	1	0
 

                        c = 64i8, l = 1
Разряды	Знаковый        6       5       4       3       2       1       0
        разряд	
c2      0	        1	0	0	0	0	0	0
c >> l  0	        0	1	0	0	0	0	0

Сдвиг на одну позицию вправо эквивалентен целочисленному делению на 2. В об­щем случае сдвиг на 
n позиций вправо эквивалентен целочисленному делению на 2**n.

Игровая площадка ⛱️

Составные побитовые операторы
Аналогично арифметическим операторам для побитовых также существуют сокращённые записи. Составные операторы присваивания побитовых операций:

Название	                Оператор	Пример              Результат
                                                a = -6, b = 2	

Побитовый И	                &=	        a &= b	            a = 2
Побитовый ИЛИ	                |=	        a |= b	            a = -6
Побитовое исключающее ИЛИ	^=	        a ^= b	            a = -8
Побитовый сдвиг влево	        <<=	        a <<= b	            a = -24
Побитовый сдвиг вправо	        >>=	        a >>= b	            a = -2